<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="assets/img/Tinylogo.png" type="image/png">
  <title>ระบาย</title>
  <style>
    @font-face {
      font-family: 'TORSILPCHILLCHILL';
      src: url('fonts/TORSILPCHILLCHILL.TTF') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'TORSILPCHILLCHILL', sans-serif;
      background-image: url('assets/img/writeclose2.png');
      background-size: cover;
      background-position: center;
      height: 100vh;
      position: relative;
    }
    /* ปรับโครงสร้างให้ใช้ Flexbox จัดวางในแนวแถว */
    .content-wrapper {
      position: absolute;
      top: 55%;
      left: 40vw;  /* ปรับตำแหน่งแนวนอนตามที่ต้องการ */
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 2vw;  /* ช่องว่างระหว่างรูปกับปุ่ม */
    }
    .container {
      position: relative;
      width: 35vw;
      height: 35vw;
      box-sizing: border-box;
      border-radius: 1.5vw;
      box-shadow: 0 0.4vw 0.6vw rgba(0, 0, 0, 0.1);
    }
    .container img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 1vw;
    }
    /* ปุ่ม Go Back ด้วยไอคอน SVG */
    .back-btn {
      position: absolute;
      top: 1.4vw;    /* 20px ≈ 1.4vw */
      left: 1.4vw;   /* 20px ≈ 1.4vw */
      width: 4.2vw;   /* 60px ≈ 4.2vw */
      height: 4.2vw;  /* 60px ≈ 4.2vw */
      border: none;
      background-color: #fff;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0.14vw 0.35vw rgba(0, 0, 0, 0.2); /* 2px ≈ 0.14vw, 5px ≈ 0.35vw */
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      z-index: 1000;
    }
    .back-btn svg {
      width: 2.1vw;   /* 30px ≈ 2.1vw */
      height: 2.1vw;  /* 30px ≈ 2.1vw */
      fill: #555;
      transform: scaleX(-1); /* พลิกให้ชี้ซ้าย */
      transition: fill 0.2s ease-in-out;
    }
    .back-btn:hover {
      background-color: #f39eb6;
    }
    .back-btn:hover svg {
      fill: white;
    }
    /* จัดวางปุ่มไอคอนในแนวตั้ง */
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 1.5vh;
      margin-left: 3vw;
    }
    .save-btn, .share-btn {
      border: none;
      background-color: transparent;
      cursor: pointer;
      padding: 0;
    }
    /* กำหนดขนาดให้กับไอคอนในแต่ละปุ่ม */
    .save-btn img, 
    .share-btn img {
      background-color: #fff;
      border-radius: 50%;
      width: 4vw;
      height: 4vw;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    .save-btn img:hover, 
    .share-btn img:hover {
      background-color: #f6f2f2;
    }
  </style>
</head>
<body>
  <button class="back-btn" onclick="goBack()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
      <path d="M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"/>
    </svg>
  </button>

  <div class="content-wrapper">
    <div class="container">
      <img id="randomImage" src="" alt="Random Image">
    </div>

    <div class="action-buttons">
      <!-- ปุ่มบันทึกด้วยไอคอน -->
      <button class="save-btn" onclick="saveImage()">
        <img src="assets/img/save.png" alt="บันทึก">
      </button>
      <!-- ปุ่มแชร์ด้วยไอคอน -->
      <button class="share-btn" onclick="shareImage()">
        <img src="assets/img/share.png" alt="แชร์">
      </button>
    </div>
  </div>

  <script>
    function goBack() {
      window.location.href = "write.html";
    }

    const images = [
      'assets/img/rabyewrite3_1.png',
      'assets/img/rabyewrite3_2.png',
      'assets/img/rabyewrite3_3.png',
      'assets/img/rabyewrite3_4.png',
      'assets/img/rabyewrite3_5.png',
      'assets/img/rabyewrite3_6.png',
      'assets/img/rabyewrite3_7.png',
      'assets/img/rabyewrite3_8.png',
      'assets/img/rabyewrite3_9.png'
    ];

    function displayRandomImage() {
      const randomIndex = Math.floor(Math.random() * images.length);
      document.getElementById('randomImage').src = images[randomIndex];
    }
    displayRandomImage();

    function saveImage() {
      const imgSrc = document.getElementById('randomImage').src;
      const a = document.createElement('a');
      a.href = imgSrc;
      const fileName = imgSrc.substring(imgSrc.lastIndexOf('/') + 1);
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    async function shareImage() {
      const imgElement = document.getElementById('randomImage');
      const imgSrc = imgElement.src;

      try {
        const response = await fetch(imgSrc);
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        const blob = await response.blob();
        const fileName = imgSrc.substring(imgSrc.lastIndexOf('/') + 1);
        const file = new File([blob], fileName, { type: blob.type });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({
            files: [file],
            title: 'ดูรูปนี้สิ!',
            text: 'ฉันเจอรูปนี้และคิดว่าคุณน่าจะชอบ'
          });
          console.log('แชร์สำเร็จด้วยการแชร์ไฟล์');
        } else if (navigator.share) {
          await navigator.share({
            title: 'ดูรูปนี้สิ!',
            text: 'ฉันเจอรูปนี้และคิดว่าคุณน่าจะชอบ',
            url: imgSrc
          });
          console.log('แชร์สำเร็จด้วย URL');
        } else {
          alert('เบราว์เซอร์ของคุณไม่รองรับการแชร์');
        }
      } catch (error) {
        console.error('Error sharing:', error);
        alert('เกิดข้อผิดพลาดในการแชร์รูป: ' + error.message);
      }
    }
  </script>
</body>
</html>
